# Introduction to writing SSDT Hotpatches

## Preface

This assists you in writing your own SSDT Hotfixes from scratch. The aim is to reduce the use of binary renames to a minimum while maximizing ACPI conformity as well as compatibility with other Operating Systems.

_**But why?**_, you might ask.

Since ACPI is OS-agnostice and since OpenCore injects ACPI changes system-wide, the idea is to use SSDT patches that only affect macOS and leave the `DSDT` unchanged otherwise.

So, avoid binary patches like `HDAS` to `HDEF`, `EC0` to `EC`, `SSDT-OC-XOSI`, etc. whenever possible. Especially renaming of methods (`MethodObj`) such as `_STA`, `_OSI`, etc. should be performed with caution. Nowadays, a lot of renames are handled by kexts like **AppleALC** and **WhateverGreen** anyway.

### Introduction to ACPI Hotpatching

Unlike Windows, macOS has no hardware detection capabilities because it doesn't need it, since Macs use a fixed/set range of hardware components. So therefore Hackintoshes require fixes for certain ACPI Tables so that macOS can "understand" them. Having the correct ACPI for macOS is the foundation of a stable Hackintosh.

Although `kexts` handle a lot of patching tasks nowadays, it may be necessary to create additional patches to enable certain features (like enabling Thunderbolt or fixing Sleep issues, etc.). The preferred method to do so is **Hotpatching**.

Hotpatching means that ACPI tables or parts of them are manipulated on the fly, during system start. The original ACPI tables are extracted, then patched on the fly and handed over to macOS for further processing. There are two main techniques for hotpatching which are often combined: 1) replacing certain characters in the text of ACPI tables (binary renaming) and 2) adding SSDTs.

In order to create Hotpatches, we need to extract – or as we say, dump – the original ACPI tables from the BIOS. Some Tools can extract a machine's ACPI Form - like `SSDTTime` in Windows or Boot Managers like `OpenCore` and `Clover`.

Since ACPI tables are binary files, we need a decompiler to read and edit them, such as: [**MaciASL**](https://github.com/acidanthera/MaciASL) for macOS or [Xiasl](https://github.com/ic005k/XiASL) for Windows. When opening these files, especially the `DSDT.aml`, many errors may occur. It is important to note that in most cases, these errors are generated by the decompiler – they are not present in the ACPI forms provided by the machine.

### Important ACPI Tables for hackintoshing

#### `DSDT.aml`

As mentioned, the `DSDT` or [**Differentiated System Description Table**](https://uefi.org/specs/ACPI/6.4/05\_ACPI\_Software\_Programming\_Model/ACPI\_Software\_Programming\_Model.html#differentiated-system-description-table-dsdt) is the most important ACPI Table because it includes most of the devices of a mainboard, its features and the way they are powered. This is the primary source for researching possible fixes to turn a PC mainboard into what macOS recognizes as an iMac mainboard, for example.

#### `SSDT-xxxx.aml`

`SSDTs`or [**Secondary System Description Tables**](https://uefi.org/specs/ACPI/6.4/05\_ACPI\_Software\_Programming\_Model/ACPI\_Software\_Programming\_Model.html?highlight=ssdt#secondary-system-description-table-ssdt) are tables which can be added to, modify or replace specific parts or sections of the DSDT. This is another important category of ACPI Tables because these can be completely written by user and thereby fix issues, add fake devices which macOS wants to see or improve CPU Power Management. This includes tables such as: `SSDT-PLUG.aml`, `SSDT-PM`, `SSDT-AWAC.aml`, etc.

Other relevant ACPI Tables are: `APIC`, `BGRT`, `DMAR`, `ECDT`, `FACP`.

For more details about ACPI in general, please refer to the official [**ACPI Specification**](https://uefi.org/specs/ACPI/6.4/index.html) For an introduction to the ASL language, please refer to chapter [**ACPI Source Language Reference**](https://uefi.org/specs/ACPI/6.4/19\_ASL\_Reference/ACPI\_Source\_Language\_Reference.html?highlight=asl%20syntax).

The following sections will help you to get a deeper understanding about ACPI, ASL and Binary Renames, so you can edit SSDT files. Click on a triangle to unfold its content.

### Why to prefer SSDTs over a patched DSDT

A common problem with Hackintoshes is missing ACPI functionality when trying to run macOS on X86-based Intel and AMD systems, such as: Networking not working, USB Ports not working, CPU Power Management not working correctly, screens not turning off when the lid is closed, Sleep and Wake not working, Brightness controls not working and so on.

These issues stem from DSDTs made with Windows support in mind on one hand and Apple not sticking to ACPI tables which conform to the ACPI specs 100 % for their hardware on the other. These issues can be addressed by dumping, patching and injecting a patched DSDT during boot, replacing the original.

Since a DSDT can change when updating the BIOS, injecting an older DSDT on top of a newer one can cause conflicts and break macOS functionalities. But there are more fundamental reasons why to avoid using patched DSDTs. A word from the one of the OpenCore Devs (mhaeuser):

> Changes to DSDT are inherently unsafe and anyone who tells you otherwise demonstrates nothing but their cluelessness about firmware internals. This does not mean this never works, but the point is you unlikely verified your systems behaviour for all edge cases (resuming from all sleep states, resetting CMOS, potential recovery procedures from failed boots, etc etc). There are way too many variables, really. You also restrain yourself from updating your firmware or performing any configuration changes (hardware or software) without risking having to re-do your DSDT.

\[…]

> ACPI tables can be and are patched dynamically during firmware execution. Changing various factors, hardware and software, thus may yield a DSDT different from the one you used as your template, and thus your patched DSDT will "rollback" exactly those differences. There is no amount of "knowledge" and "language comfortability" you can gain to make this safe, this is inherently unsafe.

**Source**: [**Waybackmachine**](https://web.archive.org/web/20220807100310/https://www.insanelymac.com/forum/topic/352881-when-is-rebaseregions-necessary/). \[Actually, this post is from August 2022 and was released on insanelymac.com. But MaLd0n didn't like what he read and decided to lock the thread after he posted his helpless reply. And when he saw that I was referencing it, he deleted the whole thread. Unfortunatly for him, it was already archived…].

Therefore, dynamic patching with SSDTs is highly recommended over using a patched DSDT. Plus the whole process is much more efficient, transparent and elegant. And that’s why you should avoid patched DSDTs – especially those from MaLDon/Olarila!

Anyway, [**back to the regular scheduled program…**](../../00\_acpi-6/ssdt\_basics/02\_oc\_acpi\_handling.md)
